### Use-Case: static file serving
### Implements some pointers from html5-boilerplate apache config

# we're not really interested in logs at all
access_log off;
error_log off;

# no need for indexes, either
autoindex off;
index off;

# expires in far future
expires 1M;

# map common errors 
error_page 403 404 500 503 @error;

# assuming we're going to serve multiple resources in short bursts
keepalive_timeout 5 5; 
sendfile on;
tcp_nodelay on; # works with keepalive only
tcp_nopush on; # works with sendfile only 

# gzip 
gzip on;
gzip_static on;
gzip_vary on;
gzip_types
    # text/html is always compressed by HttpGzipModule
    text/css
    text/javascript
    text/xml
    text/plain
    text/x-component
    application/javascript
    application/x-javascript
    application/json
    application/xml
    application/rss+xml
    font/truetype
    font/opentype
    application/vnd.ms-fontobject
    image/svg+xml;

# prevent most common form of hotlinking
# remove comments if needed
#valid_referers none blocked .example.com;
#if ($invalid_referer) {
#   return 204;
#}

# serve empty gif out of memory
location = /blank.gif {
    empty_gif;
    expires max;
}

# block "hidden" files, like .gitignore 
location ~ (^|/)\. {
    return 204;
}

# alternative way of cachebusting rewrite
# @link github.com/paulirish/html5-boilerplate/wiki/Version-Control-with-Cachebusting
#location ~ ^(.+)\.(\d+)\.(js|css|png|jpe?g|gif)$ {
#    try_files $uri $1.$3;
#}

# Set expires max on some common static file types
location ~ ^.+\.(css|js|jpe?g|gif|png|ico|gz|svgz?|ttf|otf|woff|eot|mp4|ogg|ogv|webm)$ {

    expires max;

    # @link http://htaccess.wordpress.com/2009/09/22/x-content-type-options-nosniff-header/ why for msie only 
    # uncomment if not needed / wanted 
    #if ($msie) {
    #    add_header X-Content-Type-Options nosniff;
    #}
  
}

# special handling for streaming flash video files 
location ~ ^.+\.flv {
    # implicitly disables sendfile, use directio instead 
    aio on;
    directio 512;
    output_buffers 1 128k;
    flv;
}


# don't waste bandwith on error pages
location @error {
  return 204;
}
